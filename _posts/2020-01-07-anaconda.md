---
title: Using Anaconda Virtual Environments with Jupyter
date: 2020-01-07
categories:
  - development
tags:
  - jupyter
---

# Motivation

As a novice who just started learning Python just three months ago, I was clueless about what virtual environments were. All I knew was that [Anaconda] was purportedly a good way to download and use Python, in particular because it came with many scientific packages pre-installed. I faintly remember reading somewhere that Anaconda came with [conda], a package manager, but I didn't really dig much into it because I was busy learning the Python language to begin with. I wasn't interested in the complicated details---I just wanted to learn how to use this language to start building and graphing and calculating. 

And because I had on idea about how to use Anaconda or conda for that matter, I used to install packages left and right, using the pip installer through the command

```bash
pip install some_package
```
or through the conda installer, with some optional arguments and channel specifications that Google and stack exchange search would tell me to do. For a package available on `conda-forge`, I might have triggered a command something like this:

```bash
conda install -c conda-forge some_package
```

The reason why I never bothered to dig into the intricacies of these installation options was that I never felt the need to: they almost always worked. After installing a package, I had no trouble importing it on PyCharm or Sublime. Of course, there were some packages that simply didn't work, such as `PyPDF`, but those were extremely rare, and I was always able to find an alternative package with similar functionality. Admittedly, this in large part because the packages I use most often are extremely standard, such as `numpy`, `matplotlib`, and occasionally `scipy` and `sklearn`, all of which are shipped with Anaconda by default. 

Problems started to arise only recently when I decided to starting learning [R] to expand my knowledge in the domain of statistical computing. After some quick research, I found that there were two ways of installing R on a local system. The most popular and easiest way was to download it straight from [CRAN], the Comprehensive R Archive Network. This was the course I followed first, and it was great---until I realized that configuring Jupyter Notebooks is not convenient in this setup. Ever since I got acquainted with Jupyter Notebooks about a month ago, I have fallen love with it so quickly that it is now the default platform I use to write posts for this blog. The fact that the CRAN distribution didn't play with Jupyter was a problem, so I decided to find alternative installation channels, which led me to the second option: install R with conda.

# R with Conda

Installing R with conda could quite easily be achieved with a single command line. 

```bash
conda install -c r r-essentials
```

This command installs both R and the `r-essentials` package, which includes approximately 80 most popular scientific packages for the R programming language. Great! It took a few minutes for my laptop to complete the installation, but it eventually got through. Now, I should be good to go, right?

Only, I noticed a few problems. First, when I opened a new terminal window, I realized that it took noticeably longer for the terminal to load. The bash shell seemed to look up multiple languages, such as `python`, `java`, and `r` before fully loading, which I figured was a problem---even to the uneducated eye, this meant that the system was unnecessarily clogged. It is also roughly during this time that I started to understand how virtual environments worked in conda, so I decided to perform the following tasks:

* Wipe all package installations on root
* Create Conda virtual environments, including one specific to R
* Install all R packages in that virtual environment
* Reinstall other Python modules I might need in the virtual environments

Through this, what I wanted to achieve was a clean system root environment, with all packages installed in specific virtual environments that I could toggle on or off depending on my workflow. 

# Jupyter with Conda R

# RStudio with Conda R

Anaconda offers the option of installing RStudio through the Anaconda distribution. However, much like the vast majority of R users I saw online, I do not recommend downloading RStudio through Anaconda: the RStudio application available on Anaconda is not up to date, nor is it supported by CRAN. Instead, we can install RStudio through CRAN, but configure RStudio to locate the R profile in the Anaconda directory instead of the standard directory that would be created had we installed the R language through CRAN. This sounds a needlessly complicated, so let's hash it out step-by-step. 

## Configuring RStudio

Follow [this link] to install the RStudio application, which is the most widely used default IDE for the R programming language. The good thing about RStudio is that it is free and open source, which is something that everybody likes. The installation should be very straight forward, so I'll jump straight into the problem. When you complete the installation and run the application, you will run into this error message. 

<img src="/assets/images/rstudio-error.png">

This message means that RStudio was unable to locate the directory where R is installed. The problem arises because we installed R through conda, not through CRAN. Therefore, we have to manually specify the Anaconda directory where R is installed for RStudio. In other words, we have to force RStudio to use a specific version of R installed on our system. This can be achieved by typing this bash command in the terminal:

```bash
export RSTUDIO_WHICH_R=some/R/directory/on/system
```
But how do we figure out where the Anaconda R directory is located? First, let's activate the conda virtual environment where R is installed. 

```bash
(base) Jakes-MacBook-Pro:~ jaketae$ source activate R
```
Next, we invoke the `which R` command to see where R is installed.

```bash
(R) Jakes-MacBook-Pro:~ jaketae$ which R
/Users/jaketae/opt/anaconda3/envs/R/bin/R
```
Great! Now we know where the R profile is. All we have to do is use the `export` command to configure the R directory for RStudio. In my case, this would look as follows:

```bash
export RSTUDIO_WHICH_R=/Users/jaketae/opt/anaconda3/envs/R/bin/R
```

And now we are done! Well, almost. If you try to open RStudio, it will still show you the same error. Instead of opening the app via the launchpad, we have to open RStudio through the same terminal we used to configure RStudio. In other words, in the same terminal window, type

```bash
cd 
cd /Applications
open RStudio.app
```
Now, RStudio should boot up and you should be able to use it without any problems! 

## Creating Alias

This approach works, but it's also inconvenient because we have to go through this process every time when we want to open up RStudio. Not really productive, is it?

The way to go about this problem is to create a [shell alias]. An alias is basically a personalized command on the terminal that we can invoke. Using an alias, we can also chain multiple bash commands into a sweet, single line. Pretty convenient, isn't it? It also suits our purpose because essentially the steps we have to take to launch R is type multiple commands on the shell interface before finally launching RStudio from the terminal. 

To create a system-wide alias, we have to add an alias to our bash profile. First, let's locate the bash profile on our system in the root directory

```bash
(base) Jakes-MacBook-Pro:~ jaketae$ cd
(base) Jakes-MacBook-Pro:~ jaketae$ ls -la
total 320
# many entries
-rw-r--r--@   1 jaketae  staff    891 Dec 30 05:15 .bash_profile
# many entries
```
This is what shows up in my terminal. It tells me that there are 320 files in the root directory, one of which is the `.bash_profile` file that we have to edit to make our alias system-wide and permanent. Let's open the `.bash_profile`.

```bash
(base) Jakes-MacBook-Pro:~ jaketae$ open .bash_profile
```
A text editor will pop up, allowing us to view and edit the contents of the `.bash_profile`. After the last line of the profile, add the following lines.

```bash
alias launchR='export RSTUDIO_WHICH_R=/Users/jaketae/opt/anaconda3/envs/R/bin/R; cd /Applications; open RStudio.app'
``` 

The alias I created is `launchR`. Essentially, what it does is that it chains multiple linux command lines into one convenient command that I can invoke in any terminal. It will automatically configure RStudio to look for the specific Anacdona directory where R in installed in and open the RStudio application by browsing into the appropriate `/Applications` directory. In other words, instead of going through all the hassle, we can now simply type `launchR`, and RSTudio will fire up, ready for use! 

# Conclusion



[R]: https://www.r-project.org
[Anaconda]: https://anaconda.org
[conda]: https://conda.io/en/
[CRAN]: http://cran.r-project.org/mirrors.html
[this link]: https://rstudio.com
[shell alias]: https://www.geeksforgeeks.org/alias-command-in-linux-with-examples/
